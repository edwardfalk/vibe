---
description: Auto Docs & Changelog Workflow
globs: 
alwaysApply: false
---
# Auto Docs & Changelog Workflow
> **Purpose:** Keep the CHANGELOG accurate and ensure unresolved CodeRabbit comments become actionable tickets on every push to `unstable`.

### 📜 Workflow Overview
1. **Trigger** – Every push to `unstable` starts the GitHub Action defined in [`auto-docs.yml`](mdc:.github/workflows/auto-docs.yml).
2. **Setup** – Action checks out the repo and installs Bun (via `oven-sh/setup-bun`).
3. **Changelog Generation** – Runs [`scripts/generate-changelog.js`](mdc:scripts/generate-changelog.js) which  
   - Finds commits since the last git tag (or first commit if none).  
   - Groups them by Conventional-Commit type (`feat`, `fix`, `docs`, …).  
   - Prepends a new section to `docs/CHANGELOG.md` (creates the file if missing).
4. **Optional follow-ups**  
   - For review triage, use the MCP workflow: [PR_REVIEW_TO_ISSUES_WORKFLOW.md](mdc:docs/PR_REVIEW_TO_ISSUES_WORKFLOW.md)  
   - Do not run legacy collectors or parse `coderabbit-reviews/**` artifacts.
5. **Auto-commit** – If the CHANGELOG changed, the workflow commits back to `unstable` with  
   ```
   docs: auto-update changelog & coderabbit follow-ups [skip ci]
   ```

### ✅ Contributor Contract (MUST-do)
- Use **Conventional Commits** and reference the related Ticket ID in your commit/PR title.
- Update docs/rules and tick the "Docs/rules updated" box in [`PULL_REQUEST_TEMPLATE.md`](mdc:.github/PULL_REQUEST_TEMPLATE.md) when applicable.
- If you rebase or force-push, re-run the local helpers below before pushing.

### 🏃‍♂️ Local Helpers
| Purpose | Command |
| --- | --- |
| Generate changelog preview | `$ bun run gen:changelog` |
| Generate CodeRabbit follow-up GitHub Issue | `$ bun run postmerge:reviews` |

### 🛠 Debugging Tips
- **Unit-test generator**: `$ bunx jest scripts/generate-changelog.test.js`  
- **Dry-run ticket creation**: `$ bun run postmerge:reviews --dry`  
- Remove mentions of local Ticket API; GitHub Issues workflow is used exclusively.

### ⚠️ Common CI Failure Modes & Remedies
| Symptom | Likely Cause | Fix |
| --- | --- | --- |
| "GitHub rate limit" warning | GITHUB_TOKEN missing or low rate limits | Add token to `.env` or retry later |
| `docs/CHANGELOG.md` merge conflict | Force-push after others merged | `$ bun run gen:changelog` then resolve conflict, re-commit |

### 🧰 Toolchain Requirements
- Bun ≥ **1.1.9** (enforced by `bun.lock`)  
- Node ≥ **18** if running generators via Node

### 🚀 Extending the Workflow
- ☐ Auto-close resolved CodeRabbit comments after merge  
- ☐ Post Slack/GitHub notification when unresolved comments > N  
- ☐ Auto-fix simple Markdown suggestions and open a PR

### 🖼 Diagram
```mermaid
sequenceDiagram
    participant Dev
    participant GH as GitHub Action
    participant Chg as generate-changelog.js
    participant CR as post-merge-review-check.js
    Dev->>GH: push to unstable
    GH->>Chg: run changelog script
    GH->>CR: run review script
    CR->>TicketAPI: create TASK ticket
    GH->>Repo: commit updated CHANGELOG / tickets
```

