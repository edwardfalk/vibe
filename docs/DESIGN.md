# Vibe Game Design: Cosmic Beat System & Core Concepts

> **Purpose:**  
> This document explains the musical gameplay system and core design concepts.  
> For current standards and rules, see `.cursor/rules/`.

## Cosmic Beat System Overview

Vibe is built around a unique musical timing system—the "Cosmic Beat"—which synchronizes enemy actions and player experience to a rhythmic pulse. This system creates an emergent musical experience as players interact with the game world.

### How the Cosmic Beat Works

- **BeatClock.js** implements the core timing logic, running at a configurable BPM (beats per minute).
- The game uses a 4/4 time signature, with each measure divided into four beats.
- Enemy actions are locked to specific beats, while the player can act freely, creating a natural musical interplay.

#### Musical Mapping

- **Player**: Free shooting (creates a hi-hat feel)
- **Grunts**: Attack on beats 2 & 4 (snare drum)
- **Tanks**: Attack on beat 1 (bass drum)
- **Stabbers**: Attack on beat 3.5 (off-beat accent)
- **Rushers**: Can charge on any beat, but explode on strong beats (1 or 3)

This mapping ensures that gameplay actions naturally form a musical pattern, which players discover and internalize as they play.

---

## BeatClock: Technical Details

The `BeatClock` class (see `packages/core/src/BeatClock.js`) provides the following features:

- Tracks elapsed time and calculates the current beat within each measure.
- Provides methods for checking if the game is "on beat" (with a configurable tolerance window).
- Exposes specialized timing checks for each enemy type (e.g., `canGruntShoot()`, `canTankShoot()`, `canStabberAttack()`).
- Supports dynamic tempo changes and precise quarter-beat timing for advanced mechanics.

**Example Usage:**

```js
import { BeatClock } from './BeatClock.js';
const beatClock = new BeatClock(120); // 120 BPM
if (beatClock.isOnBeat([2, 4])) {
  // Grunt attacks (snare)
}
```

---

## Emergent Musical Gameplay

- The player is not forced to act on the beat, but enemy actions create a musical structure.
- This results in a dynamic soundtrack generated by gameplay itself, blending player actions with enemy rhythms.
- The system is extensible: new enemy types or actions can be mapped to different beats or subdivisions.

---

## References

- `packages/core/src/BeatClock.js`: Full implementation and in-code documentation
- `packages/game/src/GameLoop.js`: Integration of BeatClock with the main game loop
- ../README.md: Project overview and modular architecture

---

_For further details on coding standards and architecture, see the README and `.cursor/rules/`._
